{% extends 'untabbed_datatables.html' %}

{% block head %}
    {{ super() }}
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css"/>
    <script src="{{ url_for('static', filename='library_preps.js') }}"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/heatmap.js"></script>
{% endblock %}

{% block content %}

{{ super() }}

<br/>

<div class="btn-group">
  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Metric <span class="caret"></span>
  </button>
  <ul id="qc_options" class="dropdown-menu"></ul>
</div>

<p>Plotting sample and library prep QC for {{ library }}.</p>


<div id="heatmap" class="heatmap"></div>

<script>
    var app_metrics = ['pc_q30', 'pc_mapped_reads'];
    var udfs = ['Ave. Conc. (nM)', '%CV', 'Raw CP', 'NTP Volume (uL)', 'Adjusted Conc. (nM)', 'Original Conc. (nM)',
                'NTP Transfer Volume (uL)', 'RSB Transfer Volume (uL)', 'Sample Transfer Volume (uL)',
                'TSP1 Transfer Volume (uL)'];

    metrics = {};
    var qc_options = $('#qc_options');

    function add_metric(m) {
        var li = $('<li>');
        var button = $('<a>').attr('id', m).text(m);
        li.append(button);
        qc_options.append(li);
        button.click(function() {
          retrigger(this.id);
        });
    }

    qc_options.append($('<li>').attr('class', 'dropdown-header').text('UDFs'));
    for (var i=0; i<udfs.length; i++) {
        var udf = udfs[i];
        metrics[udf] = ['udf', udf];
        add_metric(udf);
    }

    qc_options.append($('<li>').attr('class', 'dropdown-header').text('Reporting app'));
    for (var i=0; i<app_metrics.length; i++) {
        var m = app_metrics[i];
        metrics[m] = ['reporting_app', 'aggregated', m];
        add_metric(m);
    }

    active_colour_metric = 'pc_q30';

    chart = highchart('heatmap', '{{ library }}');
    chart.showLoading();
    get_lims_and_qc_data(
        '{{ lims_url }}',
        '{{ qc_url }}',
        '{{ ajax_token }}',
        '{{ library }}'
    );
    chart.hideLoading();
</script>

{% endblock %}
