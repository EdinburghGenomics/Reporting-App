{% extends 'base.html' %}

{% block head %}
    {{ super() }}
    <script src="{{ url_for('static', filename='library_preps.js') }}"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/heatmap.js"></script>
{% endblock %}

{% block content %}

<div id="lims_query">
    Plotting sample QC by library.
    <br/>
    <input type="date" name="input_time_from" id="input_time_from" placeholder="input_time_from"/>
    View libraries prepared since this date.
    <br/>
    <input type="date" name="input_time_to" id="input_time_to" placeholder="input_time_to"/>
    View libraries prepared up to this date.
    <br/>
    <input type="text" name="input_library_id" id="input_library_id" placeholder="input_library_id"/>
    View a specific library ID - takes precedence over date range.
    <br/>
    <input type="text" name="input_colour_metric" id="input_colour_metric" placeholder="aggregated.pc_q30"/>
    Enter a sample QC metric to plot as a heatmap colour.
    <br/>
    <input type="button" value="Submit" id="submit"/>
</div>

<div id="heatmaps"></div>

<script>
    function trigger() {
        var time_from = $('#input_time_from').val();
        var time_to = $('#input_time_to').val();
        var library_id = $('#input_library_id').val();
        var colour_metric = $('#input_colour_metric').val() || 'aggregated.pc_q30';
        var data = get_lims_and_qc_data(
            '{{ lims_url }}',
            '{{ qc_url }}',
            '{{ ajax_token }}',
            time_from,
            time_to,
            library_id
        );

        for (var i=0; i<data.length; i++) {
            var heatmap_id = 'heatmap_' + i;
            $('#heatmaps').append($('<div>').attr('id', heatmap_id).attr('class', 'heatmap'));
            highchart(heatmap_id, data[i], colour_metric);
        }
    }

    $('#submit').click(trigger);
</script>


{% endblock %}
