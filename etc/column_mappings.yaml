# Datatables column definitions for the reporting app
# Each column definition has a key and a dict with the following options:
#  - data: the field in the javascript object where the data is found (support dot notation)
#  - title: header of that column in the datatable
#  - visible: specify if the column will be visible by default (default is true if not set)
#  - class_name: space separated list of css class for the column
#  - fmt: reference and paramters to the cell formatter (see column_formatter.js for detail)
#      * type: formatter type (int, float, percentage, ratio_percentage, date, datetime)
#      * min: minimum bellow which the value is highlighted
#      * max: maximum bellow which the value is highlighted
#      * link: relative link formatted as baseurl/<link>/data
#      * link_format_function: javascript function name formatting the link's text
#      * name: javascript function name that will modify the data before the formating

column_def:
    bam_file_reads:           { data: 'bam_file_reads',                       title: 'Initial reads in bam',     fmt: { type: 'int' } }
    barcode:                  { data: 'barcode',                              title: 'Barcode' }
    clean_pc_q30:             { data: 'aggregated.clean_pc_q30',              title: '% Q30 - cleaned',          fmt: { type: 'percentage', min: 75 }, visible: 'false'  }
    clean_pc_q30_r1:          { data: 'aggregated.clean_pc_q30_r1',           title: '% Q30 R1 - cleaned',       fmt: { type: 'percentage', min: 75 }, visible: 'false' }
    clean_pc_q30_r2:          { data: 'aggregated.clean_pc_q30_r2',           title: '% Q30 R2 - cleaned',       fmt: { type: 'percentage', min: 75 }, visible: 'false' }
    clean_yield_in_gb:        { data: 'aggregated.clean_yield_in_gb',         title: 'Yield (Gb - cleaned)',     fmt: { type: 'float' } }
    clean_yield_q30_in_gb:    { data: 'aggregated.clean_yield_q30_in_gb',     title: 'Yield Q30 (Gb - cleaned)', fmt: { type: 'float' } }
    _created:                 { data: '_created',                             title: 'Created' }
    cv:                       { data: 'aggregated.cv',                        title: 'Coefficient of variance',  fmt: { type: 'float' }, visible: 'false' }
    delivered:                { data: 'delivered',                            title: 'Delivered'}
    duplicate_reads:          { data: 'duplicate_reads',                      title: '# duplicate reads',        fmt: { type: 'int' },    visible: 'false',         }
    lane_pc_optical_dups:     { data: 'lane_pc_optical_dups',                 title: 'Estimated dupl rate',      fmt: { type: 'float', max: 20 } }
    lane_number:              { data: 'lane_number',                          title: 'Lane' }
    library_id:               { data: 'library_id',                           title: 'Library ID' }
    library_type:             { data: 'library_type',                         title: 'Library',                                                        visible: 'false' }
    genotype_match:           { data: 'aggregated.genotype_match',            title: 'Genotype'   }
    mean_insert_size:         { data: 'mapping_metrics.mean_insert_size',     title: 'Avg Insert Size',          fmt: { type: 'float' }, visible: 'false' }
    mapped_reads:             { data: 'mapped_reads',                         title: '# mapped reads',           fmt: { type: 'int' },    visible: 'false'  }
    matching_snps:            { data: 'genotype_validation.matching_snps',    title: 'Matching snps' ,                                                 visible: 'false'}
    median_coverage:          { data: 'median_coverage',                      title: 'Median coverage',          fmt: { type: 'float', min: {field: 'Coverage (X)', default: 30} } }
    mean_coverage:            { data: 'coverage.mean',                        title: 'Mean coverage',            fmt: { type: 'float', min: {field: 'Coverage (X)', default: 30} } }
    closed_date:              { data: 'close_date',                           title: 'Closed on',                fmt: { type: 'date' }, visible: 'false' }
    coverage_5X:              { data: 'coverage',                             title: '% covered 5X',             fmt: { name: 'coverage_5X', type: 'percentage' }, visible: 'false' }
    coverage_15X:             { data: 'coverage',                             title: '% covered 15X',            fmt: { name: 'coverage_15X', type: 'percentage' } }
    evenness:                 { data: 'coverage.evenness',                    title: '% Evenness',               fmt: { type: 'ratio_percentage' } }
    mismatching_snps:         { data: 'genotype_validation.mismatching_snps', title: 'Mismatching snps' ,                                              visible: 'false'}
    nb_quoted_samples:        { data: 'nb_quoted_samples',                    title: 'Quoted Samples' ,          class_name: 'text-center sum' }
    nb_samples_delivered:     { data: 'aggregated.samples_delivered',         title: 'Samples Delivered',        fmt: {link_format_function: 'count_entities', link: '/sample/' }, class_name: 'text-center sum' }
    nb_samples:               { data: 'aggregated.samples',                   title: 'Samples',                  fmt: {link_format_function: 'count_entities', link: '/sample/' }, class_name: 'text-center sum' }
    nb_samples_reviewed:      { data: 'aggregated.samples_reviewed',          title: 'Samples Reviewed',         fmt: {link_format_function: 'count_entities', link: '/sample/' }, class_name: 'text-center sum' }
    nb_sample_submission:     { data: 'sample_submission',                    title: 'Sample Submission' ,       fmt: {link_format_function: 'count_entities', link: '/sample/' }, class_name: 'text-center sum' }
    nb_sample_qc:             { data: 'sample_qc',                            title: 'Sample QC' ,               fmt: {link_format_function: 'count_entities', link: '/sample/' }, class_name: 'text-center sum' }
    nb_library_queue:         { data: 'library_queue',                        title: 'Library Queue' ,           fmt: {link_format_function: 'count_entities', link: '/sample/' }, class_name: 'text-center sum' }
    nb_library_preparation:   { data: 'library_preparation',                  title: 'Library Preparation' ,     fmt: {link_format_function: 'count_entities', link: '/sample/' }, class_name: 'text-center sum' }
    nb_sequencing_queue:      { data: 'sequencing_queue',                     title: 'Sequencing Queue' ,        fmt: {link_format_function: 'count_entities', link: '/sample/' }, class_name: 'text-center sum' }
    nb_sequencing:            { data: 'sequencing',                           title: 'Sequencing' ,              fmt: {link_format_function: 'count_entities', link: '/sample/' }, class_name: 'text-center sum' }
    nb_bioinformatics:        { data: 'bioinformatics',                       title: 'Bioinformatics' ,          fmt: {link_format_function: 'count_entities', link: '/sample/' }, class_name: 'text-center sum' }
    nb_delivery:              { data: 'delivery',                             title: 'Delivery' ,                fmt: {link_format_function: 'count_entities', link: '/sample/' }, class_name: 'text-center sum' }
    nb_finished:              { data: 'finished',                             title: 'Finished' ,                fmt: {link_format_function: 'count_entities', link: '/sample/' }, class_name: 'text-center sum' }
    nb_removed:               { data: 'removed',                              title: 'Removed' ,                 fmt: {link_format_function: 'count_entities', link: '/sample/' }, class_name: 'text-center sum', visible: 'false' }
    nb_repeat:                { data: 'repeat',                               title: 'Request repeat' ,          fmt: {link_format_function: 'count_entities', link: '/sample/' }, class_name: 'text-center sum', visible: 'false' }
    nb_genotyped:             { data: 'genotyped',                            title: 'Genotyped' ,               fmt: {link_format_function: 'count_entities', link: '/sample/' }, class_name: 'text-center sum', visible: 'false' }
    nb_invoiced:              { data: 'invoiced',                             title: 'Invoiced' ,                fmt: {link_format_function: 'count_entities', link: '/sample/' }, class_name: 'text-center sum', visible: 'false' }
    no_call_chip:             { data: 'genotype_validation.no_call_chip',     title: 'No-call (chip)' ,                                                visible: 'false'}
    no_call_seq:              { data: 'genotype_validation.no_call_seq',      title: 'No-call (seq)' ,                                                 visible: 'false'}
    called_gender:            { data: 'called_gender',                        title: 'Called Gender' ,                                                 visible: 'false'}
    provided_gender:          { data: 'provided_gender',                      title: 'Provided Gender',                                                visible: 'false' }
    gender_match:             { data: 'aggregated.gender_match',              title: 'Gender' }
    passing_filter_reads:     { data: 'passing_filter_reads',                 title: 'Passing-filter reads',     fmt: { type: 'int' } }
    pc_adaptor:               { data: 'aggregated.pc_adaptor',                title: '% Adapter',                fmt: { type: 'percentage', max: 5 } }
    pc_duplicate_reads:       { data: 'aggregated.pc_duplicate_reads',        title: '% duplicate reads',        fmt: { type: 'percentage', max: 35 } }
    pc_opt_duplicate_reads:   { data: 'aggregated.pc_opt_duplicate_reads',    title: '% opt duplicate reads',    fmt: { type: 'percentage', max: 25 } }
    pc_mapped_reads:          { data: 'aggregated.pc_mapped_reads',           title: '% mapped reads',           fmt: { type: 'percentage', min: 90 } }
    pc_pass_filter:           { data: 'aggregated.pc_pass_filter',            title: '% Pass filter',            fmt: { type: 'percentage' } }
    pc_properly_mapped_reads: { data: 'aggregated.pc_properly_mapped_reads',  title: '% properly mapped reads',  fmt: { type: 'percentage' }, visible: 'false' }
    pc_q30:                   { data: 'aggregated.pc_q30',                    title: '%Q30',                     fmt: { type: 'percentage',  min: 75 } }
    pc_q30_r1:                { data: 'aggregated.pc_q30_r1',                 title: '%Q30 R1',                  fmt: { type: 'percentage',  min: 75 } }
    pc_q30_r2:                { data: 'aggregated.pc_q30_r2',                 title: '%Q30 R2',                  fmt: { type: 'percentage',  min: 75 } }
    pc_reads_in_lane:         { data: 'pc_reads_in_lane',                     title: '% Reads in lane',          fmt: { type: 'percentage'} }
    proc_status:              { data: 'aggregated.most_recent_proc.status',   title: 'Processing Status' }
    project_id:               { data: 'project_id',                           title: 'Project ID',               fmt: { link: '/projects/' }  }
    project_ids:              { data: 'project_ids',                          title: 'Projects',                 fmt: { link: '/projects/' } }
    project_status:           { data: 'project_status',                       title: 'Status',                                                          visible: 'false'}
    plate_id:                 { data: 'plate_id',                             title: 'Plate' }
    properly_mapped_reads:    { data: 'properly_mapped_reads',                title: '# properly mapped reads',  fmt: { type: 'int' },    visible: 'false'}
    reviewed:                 { data: 'reviewed',                             title: 'Review status' }
    review_statuses:          { data: 'aggregated.review_statuses',           title: 'Review' }
    run_id:                   { data: 'run_id',                               title: 'Run ID',                   fmt: { link: '/run/' } }
    run_ids:                  { data: 'aggregated.run_ids',                   title: 'Run ids',                  fmt: { link: '/run/' } }
    sample_id:                { data: 'sample_id',                            title: 'Sample ID',                fmt: { link: '/sample/' } }
    sample_ids:               { data: 'aggregated.sample_ids',                title: 'Sample list',              fmt: { link: '/sample/' } }
    freemix:                  { data: 'sample_contamination.freemix',         title: 'Freemix',                  fmt: { type: 'float',  max: .03}  }
    species_found:            { data: 'species_contamination',                title: 'Species found',            fmt: { name: 'species_contamination' } }
    species:                  { data: 'species',                              title: 'Species',                                                        visible: 'false'}
    useable:                  { data: 'useable',                              title: 'Useable' }
    useable_statuses:         { data: 'aggregated.useable_statuses',          title: 'Useable'}
    user_sample_id:           { data: 'User Sample Name',                     title: 'User sample ID' }
    2D_barcode:               { data: '2D Barcode',                           title: 'FluidX barcode',                                                 visible: 'false' }
    yield_in_gb:              { data: 'aggregated.yield_in_gb',               title: 'Yield (Gb)',               fmt: { type: 'float',  min: 120 } }
    yield_q30_in_gb:          { data: 'aggregated.yield_q30_in_gb',           title: 'Yield Q30(Gb)',            fmt: { type: 'float',  min: 95 } }
    reseacher:                { data: 'researcher_name',                      title: 'Researcher',                                                     visible: 'false' }
    open_date:                { data: 'open_date',                            title: 'Open Since',               fmt: { type: 'date' } }
    finished_date:            { data: 'finished_date',                        title: 'Date finished',            fmt: { type: 'date' },                visible: 'false' }
    started_date:             { data: 'started_date',                         title: 'Date started',             fmt: { type: 'date' },                visible: 'false' }
    created_date:             { data: 'created_date',                         title: 'Date started',             fmt: { type: 'date' } }
    cst_date:                 { data: 'cst_date',                             title: 'Date CST',                 fmt: { type: 'datetime' },            visible: 'false' }
    run_status:               { data: 'run_status',                           title: 'Lims status' }
    instrument_id:            { data: 'instrument_id',                        title: 'Instrument ID' }
    nb_reads:                 { data: 'nb_reads',                             title: 'Nb Reads',                 fmt: { type: 'int' },                  visible: 'false' }
    nb_cycles:                { data: 'nb_cycles',                            title: 'Nb Cycles',                fmt: { type: 'int' },                  visible: 'false' }
    current_lims_status:      { data: 'current_status',                       title: 'Lims Status' }
    expected_coverage:        { data: 'required_coverage',                    title: 'Expected Coverage (X)',    fmt: { type: 'int' },                 visible: 'false'  }
    expected_yield:           { data: 'Required Yield (Gb)',                  title: 'Expected Yield (Gb)',      fmt: { type: 'float' },               visible: 'false'  }
    expected_yield_q30:       { data: 'Yield for Quoted Coverage (Gb)',       title: 'Expected Yield Q30 (Gb)',  fmt: { type: 'float' },               visible: 'false' }
    tissue_type:              { data: 'Sample Type',                          title: 'Tissue type',                                                    visible: 'false'}
    tumor_sample:             { data: 'Is Tumor Sample',                      title: 'Is Tumor Sample',                                                visible: 'false'}
    trim_r1:                  { data: 'aggregated.trim_r1',                   title: 'Read 1 Max length',                                              visible: 'false'}
    trim_r2:                  { data: 'aggregated.trim_r2',                   title: 'Read 2 Max length',                                              visible: 'false'}
    tiles_filtered:           { data: 'aggregated.tiles_filtered',            title: 'Tile removed',                                                   visible: 'false'}
    family_id:                { data: 'Family ID',                            title: 'Family ID (SGP)',                                                visible: 'false'}

# Datatables tables definition
# the remaining top level entries each define a table with a list of column
# each column can be customised by entering a dict with a key called 'column_def' instead of the columns name
runs:
    - run_id
    - instrument_id
    - nb_reads
    - nb_cycles
    - run_status
    - cst_date
    - project_ids
    - pc_q30_r1
    - pc_q30_r2
    - pc_q30
    - clean_pc_q30_r1
    - clean_pc_q30_r2
    - clean_pc_q30
    - clean_yield_in_gb
    - clean_yield_q30_in_gb
    - pc_adaptor
    - pc_opt_duplicate_reads
    - proc_status
    - review_statuses
    - useable_statuses


projects:
    - project_id
    - { column_def: 'reseacher', visible: 'true' }
    - nb_quoted_samples
    - { column_def: 'project_status', visible: 'true' }
    - open_date
    - { column_def: 'closed_date', visible: 'true' }
    - nb_samples
    - nb_samples_reviewed
    - nb_samples_delivered
    - { column_def: 'proc_status', title: 'Bioinformatics processing' }


project_status:
    - project_id
    - reseacher
    - nb_quoted_samples
    - { column_def: 'nb_samples', title: 'Sample Received', visible: 'false', class_name: 'text-center' }
    - species
    - library_type
    - { column_def: 'expected_yield', data: 'required_yield', fmt: { type: 'string' } }
    - { column_def: 'expected_coverage', fmt: { type: 'string' } }
    - nb_invoiced
    - nb_genotyped
    - project_status
    - open_date
    - closed_date
    - started_date
    - finished_date
    - nb_removed
    - nb_repeat
    - nb_sample_submission
    - nb_sample_qc
    - nb_library_queue
    - nb_library_preparation
    - nb_sequencing_queue
    - nb_sequencing
    - nb_bioinformatics
    - nb_delivery
    - nb_finished


plate_status:
    - project_id
    - plate_id
    - { column_def: 'nb_samples', title: 'Sample Received', visible: 'false', class_name: 'text-center' }
    - species
    - library_type
    - { column_def: 'expected_yield', data: 'required_yield', fmt: { type: 'string' } }
    - { column_def: 'expected_coverage', fmt: { type: 'string' } }
    - nb_invoiced
    - nb_genotyped
    - nb_removed
    - nb_repeat
    - nb_sample_submission
    - nb_sample_qc
    - nb_library_queue
    - nb_library_preparation
    - nb_sequencing_queue
    - nb_sequencing
    - nb_bioinformatics
    - nb_delivery
    - nb_finished


demultiplexing:
    - barcode
    - project_id
    - sample_id
    - passing_filter_reads
    - { column_def: 'yield_in_gb', data: 'aggregated.yield_in_gb',  fmt: { type: 'float' }, visible: 'false' }
    - { column_def: 'clean_yield_in_gb', data: 'aggregated.clean_yield_in_gb', fmt: { type: 'float' }, visible: 'true' }
    - { column_def: 'yield_q30_in_gb',  fmt: { type: 'float'}, visible: 'false' }
    - { column_def: 'clean_yield_q30_in_gb', fmt: { type: 'float' }, visible: 'true' }
    - pc_q30
    - pc_q30_r1
    - pc_q30_r2
    - clean_pc_q30
    - clean_pc_q30_r1
    - clean_pc_q30_r2
    - lane_pc_optical_dups
    - pc_adaptor
    - pc_mapped_reads
    - pc_duplicate_reads
    - pc_opt_duplicate_reads
    - mean_insert_size
    - mean_coverage
    - reviewed
    - useable


lane_aggregation:
    - lane_number
    - sample_ids
    - { column_def: 'passing_filter_reads',  data: 'aggregated.passing_filter_reads' }
    - pc_pass_filter
    - { column_def: 'yield_in_gb',  fmt: { type: 'float',  min: 120 }, visible: 'false' }
    - { column_def: 'clean_yield_in_gb',  fmt: { type: 'float',  min: 120 }, visible: 'true' }
    - { column_def: 'yield_q30_in_gb',  fmt: { type: 'float',  min: 95 }, visible: 'false' }
    - { column_def: 'clean_yield_q30_in_gb',  fmt: { type: 'float',  min: 95 }, visible: 'true' }
    - trim_r1
    - trim_r2
    - tiles_filtered
    - pc_q30
    - pc_q30_r1
    - pc_q30_r2
    - clean_pc_q30
    - clean_pc_q30_r1
    - clean_pc_q30_r2
    - { column_def: 'lane_pc_optical_dups',  data: 'aggregated.lane_pc_optical_dups' }
    - pc_opt_duplicate_reads
    - pc_adaptor
    - cv
    - review_statuses
    - useable_statuses


unexpected_barcodes:
    - barcode
    - passing_filter_reads
    - pc_reads_in_lane


samples:
    - sample_id
    - user_sample_id
    - family_id
    - 2D_barcode
    - current_lims_status
    - library_type
    - species
    - { column_def: 'clean_yield_in_gb', title: 'Yield (Gb)', fmt: { type: 'float', min: {field: 'Required Yield (Gb)', default: 120} } }
    - { column_def: 'clean_yield_q30_in_gb', title: 'Yield Q30 (Gb)', fmt: { type: 'float', min: {field: 'Yield for Quoted Coverage (Gb)', default: 95} } }
    - expected_yield
    - expected_yield_q30
    - tissue_type
    - tumor_sample
    - { column_def: 'clean_pc_q30_r1',  title: '% Q30 R1'}
    - { column_def: 'clean_pc_q30_r2',  title: '% Q30 R2'}
    - { column_def: 'clean_pc_q30',  title: '% Q30', visible: true}
    - run_ids
    - bam_file_reads
    - mapped_reads
    - pc_mapped_reads
    - properly_mapped_reads
    - pc_properly_mapped_reads
    - duplicate_reads
    - pc_duplicate_reads
    - median_coverage
    - mean_coverage
    - coverage_5X
    - coverage_15X
    - evenness
    - species_found
    - gender_match
    - called_gender
    - provided_gender
    - genotype_match
    - matching_snps
    - mismatching_snps
    - no_call_seq
    - no_call_chip
    - freemix
    - proc_status
    - reviewed
    - useable
    - { column_def: 'delivered', visible: 'false' }
    - started_date
    - finished_date


sample_run_elements:
    - run_id
    - { column_def: 'lane_number',  data: 'lane'}
    - barcode
    - project_id
    - sample_id
    - passing_filter_reads
    - yield_in_gb
    - clean_yield_in_gb
    - pc_q30_r1
    - pc_q30_r2
    - pc_q30
    - clean_pc_q30_r1
    - clean_pc_q30_r2
    - clean_pc_q30
    - lane_pc_optical_dups
    - pc_adaptor
    - pc_mapped_reads
    - pc_duplicate_reads
    - pc_opt_duplicate_reads
    - mean_insert_size
    - mean_coverage
    - reviewed
    - useable


active_runs:
  - run_id
  - instrument_id
  - run_status
  - created_date
  - cst_date
  - project_ids
  - sample_ids
